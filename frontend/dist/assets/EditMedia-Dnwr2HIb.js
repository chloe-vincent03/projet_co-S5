import{r as a,o as T,u as P,a as D,c as o,b as C,d as l,w as V,e as $,f as N,_ as E,g as z,h as x,i as u,v as y,t as h,j as U,k as s}from"./index-BDoNwdHv.js";const B={class:"px-12 lg:px-32 py-6"},F={key:0},R={class:"mb-4 p-4 border rounded bg-gray-50"},S={key:0,class:"w-32 h-32 overflow-hidden mb-2"},A=["src"],L={class:"text-xs text-gray-500 break-all"},q={key:0},I={class:"border-t pt-6 mt-6"},G={class:"flex items-center justify-between mb-4 p-4 bg-gray-50 rounded-lg"},H={class:"flex-1"},J={class:"font-medium text-gray-700"},K={class:"text-sm text-gray-500 mt-1"},O={class:"relative inline-flex items-center cursor-pointer"},Q={key:0,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},W={class:"relative inline-flex items-center cursor-pointer"},X={key:0,class:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2 inline-block"},Y={key:1},Z={key:2},te={__name:"EditMedia",setup(ee){const d=P(),k=D(),p=a(""),f=a(""),c=a(""),b=a(""),v=a(""),m=a(""),n=a(!0),g=a(!0),_=a(!0),w=a(null);function j(t){w.value=t.target.files[0]}T(async()=>{try{const t=await fetch(`http://localhost:3000/api/media/${d.params.id}`,{credentials:"include"});if(!t.ok)throw new Error("Erreur chargement");const e=await t.json();p.value=e.title,f.value=e.description||"",c.value=e.content||"",b.value=e.tags?e.tags.join(", "):"",v.value=e.type,m.value=e.url,n.value=e.is_public===1,g.value=e.allow_collaboration===1}catch(t){console.error(t),alert("Impossible de charger les données"),k.push("/")}finally{_.value=!1}});const i=a(!1);async function M(){if(i.value)return;i.value=!0;const t=new FormData;t.append("title",p.value),t.append("description",f.value),t.append("content",c.value),t.append("tags",b.value),t.append("type",v.value),t.append("url",m.value),w.value&&t.append("file",w.value),t.append("is_public",n.value?1:0),t.append("allow_collaboration",g.value?1:0);try{const e=await fetch(`http://localhost:3000/api/media/${d.params.id}`,{method:"PUT",credentials:"include",body:t});if(e.ok)k.push(`/oeuvre/${d.params.id}`);else{const r=await e.json();alert("Erreur : "+(r.error||"Erreur inconnue"))}}catch(e){console.error("Erreur réseau:",e),alert("Erreur de connexion au serveur")}finally{i.value=!1}}return(t,e)=>(s(),o("div",B,[C(E,{to:`/oeuvre/${N(d).params.id}`,icon:"voir",size:"small",font:"inter",variant:"default",class:"mb-6",style:{backgroundColor:"var(--color-blue-plumepixel)"}},{default:V(()=>[...e[6]||(e[6]=[$(" Annuler ",-1)])]),_:1},8,["to"]),e[17]||(e[17]=l("h1",{class:"text-2xl font-['PlumePixel'] mb-6"},"Modifier l'œuvre",-1)),_.value?(s(),o("div",F,"Chargement...")):(s(),o("form",{key:1,onSubmit:z(M,["prevent"]),class:"flex flex-col gap-4 max-w-xl"},[l("div",null,[e[7]||(e[7]=l("label",{class:"block font-bold mb-1"},"Titre",-1)),u(l("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),class:"border p-2 w-full rounded",required:""},null,512),[[y,p.value]])]),l("div",null,[e[8]||(e[8]=l("label",{class:"block font-bold mb-1"},"Description",-1)),u(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>f.value=r),class:"border p-2 w-full rounded h-32"},null,512),[[y,f.value]])]),l("div",R,[e[9]||(e[9]=l("p",{class:"font-bold mb-2"},"Média actuel :",-1)),v.value==="image"?(s(),o("div",S,[l("img",{src:m.value,class:"object-cover w-full h-full"},null,8,A)])):x("",!0),l("p",L,h(m.value),1),e[10]||(e[10]=l("label",{class:"block font-bold mt-4 mb-1"},"Remplacer le fichier (optionnel) :",-1)),l("input",{type:"file",onChange:j,class:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)]),v.value==="text"?(s(),o("div",q,[e[11]||(e[11]=l("label",{class:"block font-bold mb-1"},"Contenu (Texte)",-1)),u(l("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>c.value=r),class:"border p-2 w-full rounded h-64"},null,512),[[y,c.value]])])):x("",!0),l("div",null,[e[12]||(e[12]=l("label",{class:"block font-bold mb-1"},"Tags (séparés par virgules)",-1)),u(l("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>b.value=r),class:"border p-2 w-full rounded"},null,512),[[y,b.value]])]),l("div",I,[e[16]||(e[16]=l("h3",{class:"font-bold text-gray-800 mb-4"},"Confidentialité",-1)),l("div",G,[l("div",H,[l("label",J,h(n.value?"Public":"Privé"),1),l("p",K,h(n.value?"Tout le monde peut voir cette œuvre":"Vous seul pouvez voir cette œuvre"),1)]),l("label",O,[u(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=r=>n.value=r),class:"sr-only peer"},null,512),[[U,n.value]]),e[13]||(e[13]=l("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"},null,-1))])]),n.value?(s(),o("div",Q,[e[15]||(e[15]=l("div",{class:"flex-1"},[l("label",{class:"font-medium text-gray-700"},"Collaboration Activée"),l("p",{class:"text-sm text-gray-500 mt-1"}," Les utilisateurs pourront contribuer à votre œuvre ")],-1)),l("label",W,[u(l("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),class:"sr-only peer"},null,512),[[U,g.value]]),e[14]||(e[14]=l("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"},null,-1))])])):x("",!0)]),C(E,{type:"submit",size:"large",variant:"default",disabled:i.value,style:{backgroundColor:"var(--color-blue-plumepixel)"}},{default:V(()=>[i.value?(s(),o("span",X)):x("",!0),i.value?(s(),o("span",Y,"Enregistrement...")):(s(),o("span",Z,"Enregistrer les modifications"))]),_:1},8,["disabled"])],32))]))}};export{te as default};
